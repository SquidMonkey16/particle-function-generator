<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Function Generator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="particle_icon.png">
</head>
<body>
    <div class="page">
        <div class="color-list">
            <div class="particle-entry">
                <button class="remove">â€“</button>
                <input class="particle-name" type="text" placeholder="minecraft:particle_name..." list="particles">
                <datalist id="particles">
                    <option value="minecraft:endrod"></option>
                </datalist>
                <button class="particle-color">
                    <input class="color-picker" type="color" oninput="getColor()">
                </button>
            </div>
            <button class="add-particle">Add particle</button>
        </div>
        <div class="center">
            <div class="title">Particle Function Generator</div>
            <div class="buttons">
                <button class="resize">Resize</button>
                <button class="erase">Erase</button>
                <button class="generate">Generate</button>
            </div>
            <div class="grid"></div>
        </div>
        <div class="right"></div>
    </div>
    
    <script>
        let grid = document.querySelector(".grid")
        let currSquare;
        let currRow;
        let resize = document.querySelector(".resize");
        let erase = document.querySelector(".erase");
        let numPerSide = 15;
        let squares;
        let colored = false;
        let erasing = false;
        let mouseDown;
        let colorList = document.querySelector(".color-list");
        let particleColor = document.querySelector(".particle-color");
        let colorPicker = document.querySelector(".color-picker");
        let addButton = document.querySelector(".add-particle");
        let removeButton = document.querySelector(".remove");
        let initialEntry = document.querySelector(".particle-entry")
        let entry = initialEntry.cloneNode(true);
        let activeColorButton;
        let activeColor;

        function getColor()
        {
            pickedColor = colorPicker.value;
            console.log(pickedColor);
        }

        createGrid();

        function createGrid()
        {
            for (let i = 0; i < numPerSide; ++i)
            {
                currRow = document.createElement("div")
                currRow.classList.add("row");
                grid.appendChild(currRow);
                for (let j = 0; j < numPerSide; ++j)
                {
                    currSquare = document.createElement("div");
                    currSquare.classList.add("square");
                    currRow.appendChild(currSquare);
                }
            }

            squares = document.querySelectorAll(".square");

            for (let i = 0; i < squares.length; ++i)
            {
                let square = squares[i];

                square.addEventListener("mouseover", () => {

                    if (mouseDown && !erasing && activeColorButton != null)
                        square.classList.add("on");

                    if (!mouseDown && !erasing)
                        square.classList.add("cursor");

                    if (erasing)
                        square.classList.add("erase-cursor");

                    if (erasing && mouseDown)
                        square.classList.remove("on");
                });

                square.addEventListener("mouseleave", () => {

                    square.classList.remove("cursor");

                    square.classList.remove("erase-cursor");
                });

                square.addEventListener("mousedown", () => {

                    mouseDown = true;

                    if (!erasing && activeColorButton != null)
                        square.classList.add("on");

                    if (erasing)
                        square.classList.remove("on");
                });
            }
        }

        document.addEventListener("mouseup", () => {
            
            mouseDown = false;
        })

        function removeGrid(oldNumSide)
        {
            for (let i = 0; i < oldNumSide; ++i)
            {
                grid.removeChild(grid.lastElementChild);
            }
        }

        removeButton.addEventListener("click", () => {

            initialEntry.remove();
        })

        addButton.addEventListener("click", () => {

            let newEntry = entry.cloneNode(true);

            removeButton = newEntry.querySelector(".remove");

            removeButton.addEventListener("click", () => {

                newEntry.remove();
            });

            particleColor = newEntry.querySelector(".particle-color");
            particleColor.addEventListener("click", clickParticleColor);

            // Clear inputs
            let inputs = newEntry.querySelectorAll('input');
            inputs.forEach(input => {
                input.value = "";
            });

            colorList.insertBefore(newEntry, addButton);
        })

        particleColor.addEventListener("click", clickParticleColor);

        function clickParticleColor(event)
        {
            let allColorButtons = colorList.querySelectorAll(".particle-color");

            allColorButtons.forEach(btn => btn.classList.remove("pressed"));
            activeColorButton = event.currentTarget;
            activeColorButton.classList.add("pressed");
            activeColor = activeColorButton.querySelector(".color-picker").value;
        }

        resize.addEventListener("click", () => {
            let oldNumSide = numPerSide;

            numPerSide = prompt("Enter number of squares per side: (Max 100)");
            while (numPerSide > 100 || numPerSide < 0)
            {
                numPerSide = prompt("Enter number of squares per side: (Max 100)");
            }
            
            if (numPerSide == null || numPerSide == "" || isNaN(numPerSide))
            {
                numPerSide = oldNumSide;
                return;
            }

            removeGrid(oldNumSide);
            createGrid();
        })

        erase.addEventListener("click", () => {
            erase.classList.toggle("pressed");
                if (erasing == false)
                    erasing = true;
                else
                    erasing = false;
        })
        
    </script>
</body>
</html>